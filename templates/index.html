<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>DiabCost Predictor - Dự báo chi phí đái tháo đường</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <style>
      body { font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
      .card-glass { background: rgba(255,255,255,0.85); backdrop-filter: blur(6px); }
      .field-help { font-size: 0.85rem; color: #6b7280; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-teal-50 min-h-screen">

  <!-- Header Component (keeps your web components pattern) -->
  <custom-header></custom-header>

  <main class="container mx-auto px-4 py-10">
    <div class="max-w-5xl mx-auto card-glass rounded-2xl shadow-xl overflow-hidden">
      <div class="md:flex">
        <!-- Left: Intro -->
        <div class="md:w-1/3 p-8 bg-gradient-to-b from-white to-blue-50">
          <div class="text-center">
            <img src="/static/logo.png" alt="Logo" class="mx-auto w-24 h-24 mb-4 object-contain">
            <h1 class="text-2xl font-semibold text-gray-800 mb-2">DiabCost Predictor</h1>
            <p class="text-sm text-gray-600">Ước tính chi phí điều trị một đợt cho người bệnh đái tháo đường dựa trên đặc điểm cá nhân</p>
          </div>

          <div class="mt-6 text-sm text-gray-700 space-y-3">
            <p><strong>Lưu ý:</strong></p>
            <ul class="list-disc list-inside text-gray-600">
              <li>Điền đầy đủ thông tin để có kết quả chính xác.</li>
              <li>Dữ liệu được xử lý theo pipeline đã train.</li>
              <li>Không dùng cho chẩn đoán lâm sàng.</li>
            </ul>
          </div>

          <div class="mt-6 text-center">
            <button id="exampleBtn" type="button" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg">
              <i data-feather="zap"></i>
              Điền mẫu ví dụ
            </button>
          </div>
        </div>

        <!-- Right: Form -->
        <div class="md:w-2/3 p-8">
          <form action="{{ url_for('predict') }}" method="post" id="predict-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Row 1 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Năm dự báo</label>
              <input name="Năm điều trị" type="number" placeholder="Ví dụ: 2025" class="mt-1 w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400">
              <!-- <p class="field-help mt-1">Ví dụ: 2024</p> -->
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Nơi điều trị</label>
              <input name="Nơi điều trị" list="place-list" placeholder="HN = TP.Hà Nội, HCM = TP.HCM" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="place-list">
                <option value="HN">TP.Hà Nội</option>
                <option value="HCM">TP.HCM</option>
              </datalist>
            </div>

            <!-- Row 2 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Giới tính</label>
              <input name="Giới tính" list="gender-list" placeholder="1 = Nam, 2 = Nữ" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="gender-list">
                <option value="1">Nam</option>
                <option value="2">Nữ</option>
              </datalist>
            </div>

            <!-- Row 3 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Tuổi</label>
              <input name="Độ tuổi" type="number" placeholder="Ví dụ: 55" class="mt-1 w-full px-3 py-2 border rounded-lg">
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Nhóm tuổi</label>
              <input name="Nhóm tuổi" list="agegroup-list" placeholder="Ví dụ: 40-59" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="agegroup-list">
                <option value="18-39"></option>
                <option value="40-59"></option>
                <option value="≥60"></option>
              </datalist>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Vùng – khu vực đăng ký BHYT</label>
              <input name="Vùng - khu vực đăng ký BHYT" list="regions-list" placeholder="Ví dụ: Đông Nam Bộ" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="regions-list">
                <option value="Đông Nam Bộ"></option>
                <option value="Đồng Bằng Sông Hồng"></option>
                <option value="Đồng Bằng Sông Cửu Long"></option>
                <option value="Bộ Quốc Phòng, Chính phủ"></option>
                <option value="Bắc Trung Bộ và Duyên Hải Miền Trung"></option>
                <option value="Trung du và MN phía Bắc"></option>
                <option value="Tây Nguyên"></option>
              </datalist>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Nhóm đối tượng tham gia BHYT</label>
              <input name="Nhóm đối tượng tham gia BHYT" list="HI-list" placeholder="Ví dụ: Hộ gia đình đóng" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="HI-list">
                <option value="Hộ gia đình đóng"></option>
                <option value="Tổ chức BHXH đóng"></option>
                <option value="Ngân sách Nhà nước đóng"></option>
                <option value="Người lao động, người sử dụng lao động đóng"></option>
                <option value="Ngân sách Nhà nước hỗ trợ đóng"></option>
              </datalist>
            </div>

            <!-- Row 4 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Mức thanh toán BHYT</label>
              <input name="Mức hưởng BHYT" list="insurance-list" placeholder="Ví dụ: 80%" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="insurance-list">
                <option value="80%"></option>
                <option value="95%"></option>
                <option value="100%"></option>
              </datalist>
            </div>

            <!-- Row 5 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Bệnh kèm</label>
              <input name="Bệnh kèm" list="checkComorbidities-list" placeholder="0 = Không, 1 = Có" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="checkComorbidities-list">
                <option value="0">Không</option>
                <option value="1">Có</option>
              </datalist>
              <!-- <p class="field-help mt-1">Dùng để báo có/không các bệnh kèm.</p> -->
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Loại bệnh kèm</label>
              <input name="Loại bệnh kèm" list="comorb-list" placeholder="Ví dụ: E78" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="comorb-list">
                <option value="E78">Rối loạn lipid máu (E78)</option>
                <option value="I10">Tăng huyết áp (I10)</option>
                <option value="E78+I10">E78+I10</option>
                <option value="Benh khac">Bệnh kèm khác/Không có</option>
              </datalist>
            </div>

            <!-- Row 6 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Số biến chứng</label>
              <select name="Số biến chứng" class="mt-1 w-full px-3 py-2 border rounded-lg">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="≥3">3+</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Loại biến chứng</label>
              <input name="Loại biến chứng" list="loaiBienChung-list" placeholder="Ví dụ: MML (Mạch máu lớn)" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="loaiBienChung-list">
                <option value="MML">Mạch máu lớn (MML)</option>
                <option value="MMN">Mạch máu nhỏ (MMN)</option>
                <option value="BCCH">Biến chứng chuyển hoá (BCCH)</option>
                <option value="MML+MMN"></option>
                <option value="MML+BCCH"></option>
                <option value="MMN+BCCH"></option>
                <option value="MML+MMN+BCCH"></option>
                <option value="Khong">Không</option>
              </datalist>
            </div>

            <!-- Row 7 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Điểm biến chứng</label>
              <select name="Điểm biến chứng" class="mt-1 w-full px-3 py-2 border rounded-lg">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="≥3">3+</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Tuyến bệnh viện điều trị</label>
              <input name="Tuyến bệnh viện điều trị" list="tuyen-list" placeholder="Ví dụ: Tuyến Trung ương" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="tuyen-list">
                <option value="Trung ương"></option>
                <option value="Tỉnh"></option>
                <option value="Quận/Huyện"></option>
                <option value="Xã/Phường"></option>
                <option value="Y tế cơ quan"></option>
                <option value="Không phân tuyến"></option>
              </datalist>
            </div>

            <!-- Row 8 -->
            <div>
              <label class="block text-sm font-medium text-gray-700">Mã lý do vào viện</label>
              <input name="Lý do vào viện" list="MA_LYDO_VVIEN-list" placeholder="Ví dụ: Đúng tuyến" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="MA_LYDO_VVIEN-list">
                <option value="1">Đúng tuyến</option>
                <option value="2">Cấp cứu</option>
                <option value="3">Trái tuyến</option>
                <option value="4">Thông tuyến</option>
              </datalist>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700">Hình thức khám chữa bệnh</label>
              <input name="Hình thức khám chữa bệnh" list="MA_LOAI_KCB-list" placeholder="Ví dụ: Khám bệnh" class="mt-1 w-full px-3 py-2 border rounded-lg">
              <datalist id="MA_LOAI_KCB-list">
                <option value="1">Khám bệnh</option>
                <option value="2">Điều trị ngoại trú</option>
                <option value="3">Điều trị nội trú</option>
                <option value="7">Nhận thuốc theo hẹn (không khám bệnh)</option>
                <option value="9">Điều trị nội trú dưới 04 (bốn) giờ</option>
              </datalist>
            </div>  

            <!-- Row 9 -->
            <div class="md:col-span-2">
            <!-- <div> -->
              <label class="block text-sm font-medium text-gray-700">Số ngày điều trị</label>
              <input name="Số ngày điều trị" type="number" placeholder="Nhập số ngày" class="mt-1 w-full px-3 py-2 border rounded-lg">
            </div>

            <!-- Submit -->
            <div class="md:col-span-2 pt-4">
              <button type="submit" class="w-full inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-3 rounded-lg">
                <i data-feather="activity"></i>
                Dự báo chi phí
              </button>
            </div>
          </form>

          <!-- Server-rendered prediction area (Flask will inject prediction_cost if present) -->
          {% if prediction_cost %}
            <div id="server-prediction" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
              <p class="text-sm text-green-700 font-medium">Kết quả:</p>
              <p class="text-lg font-semibold text-green-800 mt-1">{{ prediction_cost }}</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </main>

  <!-- Footer Component -->
  <custom-footer></custom-footer>

  <!-- Components & Scripts -->
  <script src="components/header.js"></script>
  <script src="components/footer.js"></script>
  <script>
    feather.replace();

    // Example button fills the form with sample values (for quick testing)
    document.getElementById('exampleBtn').addEventListener('click', function () {
      const sample = {
        'Năm điều trị': 2024,
        'Nơi điều trị': 'HN',
        'Giới tính': '1',
        'Nhóm tuổi': '40-59',
        'Độ tuổi': 55,
        'Nhóm đối tượng tham gia BHYT': 'Tổ chức BHXH đóng',
        'Mức hưởng BHYT': '80%',
        'Vùng - khu vực đăng ký BHYT': 'Đồng Bằng Sông Hồng',
        'Bệnh kèm': '1',
        'Loại bệnh kèm': 'I10',
        'Số biến chứng': '1',
        'Loại biến chứng': 'MMN',
        'Điểm biến chứng': '1',
        'Tuyến bệnh viện điều trị': '2',
        'Lý do vào viện': '1',
        'Hình thức khám chữa bệnh': '1',
        'Số ngày điều trị': 5
      };
      for (const k in sample) {
        const el = document.querySelector(`[name="${k}"]`);
        if (el) el.value = sample[k];
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // If server returned prediction_cost, scroll to result
    document.addEventListener('DOMContentLoaded', function () {
      const serverBox = document.getElementById('server-prediction');
      if (serverBox) {
        serverBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    });
  </script>

  <!-- Optional analytics / badges -->
  <script src="https://huggingface.co/deepsite/deepsite-badge.js"></script>
</body>
</html>
